<div class="dashboard-container">
  <!-- Header do Dashboard -->
  <div class="dashboard-header">
    <mat-card class="header-card">
      <mat-card-content>
        <div class="d-flex justify-content-between align-items-center">
          <h2>Volatus Logísitca - Estatísticas das Entregas</h2>
          <div class="header-actions">
            <div class="auto-refresh-indicator">
              <mat-icon class="refresh-icon">autorenew</mat-icon>
              <span class="refresh-text">Atualização automática ativa</span>
            </div>
          </div>
        </div>
      </mat-card-content>
    </mat-card>
  </div>

  <!-- Métricas principais -->
  <div class="metrics-grid">
    <mat-card class="metric-card">
      <mat-card-content>
        <div class="metric-item">
          <div class="metric-icon">
            <mat-icon>local_shipping</mat-icon>
          </div>
          <div class="metric-content">
            <h3>{{ metrics.totalDeliveries }}</h3>
            <p>Total de Entregas</p>
          </div>
        </div>
      </mat-card-content>
    </mat-card>

    <mat-card class="metric-card">
      <mat-card-content>
        <div class="metric-item">
          <div class="metric-icon success">
            <mat-icon>check_circle</mat-icon>
          </div>
          <div class="metric-content">
            <h3>{{ metrics.completedDeliveries }}</h3>
            <p>Entregas Concluídas</p>
          </div>
        </div>
      </mat-card-content>
    </mat-card>

    <mat-card class="metric-card">
      <mat-card-content>
        <div class="metric-item">
          <div class="metric-icon warning">
            <mat-icon>schedule</mat-icon>
          </div>
          <div class="metric-content">
            <h3>{{ formatTime(metrics.averageDeliveryTimeSeconds) }}</h3>
            <p>Tempo Médio por Entrega</p>
          </div>
        </div>
      </mat-card-content>
    </mat-card>

    <mat-card class="metric-card">
      <mat-card-content>
        <div class="metric-item">
          <div class="metric-icon info">
            <mat-icon>trending_up</mat-icon>
          </div>
          <div class="metric-content">
            <h3>{{ metrics.successRate.toFixed(1) }}%</h3>
            <p>Taxa de Sucesso</p>
          </div>
        </div>
      </mat-card-content>
    </mat-card>

    <mat-card class="metric-card" *ngIf="metrics.mostEfficientDrone">
      <mat-card-content>
        <div class="metric-item">
          <div class="metric-icon success">
            <mat-icon>star</mat-icon>
          </div>
          <div class="metric-content">
            <h3>{{ metrics.mostEfficientDrone.name }}</h3>
            <p>Drone Mais Eficiente</p>
            <small>{{ metrics.mostEfficientDrone.completedDeliveries }} entregas</small>
          </div>
        </div>
      </mat-card-content>
    </mat-card>
  </div>

  <!-- Conteúdo principal -->
  <div class="main-content">
    <!-- Status e Informações dos Drones - Seção mesclada -->
    <mat-card class="detail-card drones-info-card">
      <mat-card-header>
        <mat-card-title>Status e Informações dos Drones</mat-card-title>
        <mat-card-subtitle>Informações detalhadas em tempo real dos drones</mat-card-subtitle>
      </mat-card-header>
      <mat-card-content>
        <div class="drones-info-grid" *ngIf="drones.length > 0; else noDrones">
          <div class="drone-info-item" *ngFor="let drone of drones">
            <div class="drone-main-info">
              <div class="drone-header">
                <h4>{{ drone.name }}</h4>
                <p class="serial-number">S/N: {{ drone.serialNumber }}</p>
              </div>
              <div class="drone-position-info">
                <p><strong>Posição Atual:</strong> ({{ drone.currentX }}, {{ drone.currentY }})</p>
                <p><strong>Destino:</strong> ({{ drone.targetX }}, {{ drone.targetY }})</p>
              </div>
            </div>
            <div class="drone-status-info">
              <mat-chip [color]="getStatusColor(drone.status)" selected>
                {{ getStatusLabel(drone.status) }}
              </mat-chip>
              <div class="progress-section">
                <mat-progress-bar 
                  mode="determinate" 
                  [value]="drone.batteryLevel"
                  [color]="drone.batteryLevel < 20 ? 'warn' : 'primary'"
                ></mat-progress-bar>
                <span class="battery-text">{{ drone.batteryLevel }}%</span>
              </div>
            </div>
          </div>
        </div>
        <ng-template #noDrones>
          <div class="empty-state">
            <mat-icon>drone</mat-icon>
            <p>Nenhum drone disponível no momento</p>
          </div>
        </ng-template>
      </mat-card-content>
    </mat-card>

    <!-- Entregas Recentes -->
    <mat-card class="detail-card">
      <mat-card-header>
        <mat-card-title>Entregas Recentes</mat-card-title>
        <mat-card-subtitle>Últimas entregas realizadas</mat-card-subtitle>
      </mat-card-header>
      <mat-card-content>
        <div class="deliveries-list" *ngIf="recentDeliveries.length > 0; else noDeliveries">
          <div class="delivery-item" *ngFor="let delivery of recentDeliveries">
            <div class="delivery-info">
              <h4>{{ delivery.customerName }}</h4>
              <p>{{ delivery.customerAddress }}</p>
              <p>{{ delivery.description }}</p>
              <p>Peso: {{ delivery.weight }}kg | Prioridade: {{ delivery.priority }}</p>
            </div>
            <div class="delivery-status">
              <mat-chip [color]="getDeliveryStatusColor(delivery.status)" selected>
                {{ getDeliveryStatusLabel(delivery.status) }}
              </mat-chip>
              <span class="delivery-time">{{ formatEventTime(delivery.createdAt) }}</span>
            </div>
          </div>
        </div>
        <ng-template #noDeliveries>
          <div class="empty-state">
            <mat-icon>local_shipping</mat-icon>
            <p>Nenhuma entrega realizada ainda</p>
          </div>
        </ng-template>
      </mat-card-content>
    </mat-card>

    <!-- Log de Eventos -->
    <mat-card class="detail-card">
      <mat-card-header>
        <mat-card-title>Log de Eventos</mat-card-title>
        <mat-card-subtitle>Histórico de atividades do sistema</mat-card-subtitle>
      </mat-card-header>
      <mat-card-content>
        <div class="events-log" *ngIf="events.length > 0; else noEvents">
          <div class="event-item" *ngFor="let event of events.slice(0, 10)">
            <div class="event-time">{{ formatEventTime(event.createdAt) }}</div>
            <div class="event-description">
              <strong>{{ event.title }}</strong><br>
              {{ event.description }}
            </div>
          </div>
        </div>
        <ng-template #noEvents>
          <div class="empty-state">
            <mat-icon>event_note</mat-icon>
            <p>Nenhum evento registrado</p>
          </div>
        </ng-template>
      </mat-card-content>
    </mat-card>
  </div>
</div> 